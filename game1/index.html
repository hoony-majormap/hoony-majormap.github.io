<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Career High : Flex Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>

    <link
        href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;800&family=Rajdhani:wght@600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #0f172a;
            color: white;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden;
        }

        .font-num {
            font-family: 'Rajdhani', sans-serif;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .animate-pop {
            animation: pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .animate-bounce-slow {
            animation: bounce 2s infinite;
        }

        @keyframes pop {
            0% {
                transform: scale(0.9);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        .tier-badge-1 {
            background: #9ca3af;
            color: #1f2937;
        }

        .tier-badge-2 {
            background: #94a3b8;
            color: #0f172a;
            border: 1px solid #cbd5e1;
        }

        .tier-badge-3 {
            background: linear-gradient(135deg, #facc15, #ca8a04);
            color: #422006;
        }

        .tier-badge-4 {
            background: linear-gradient(135deg, #22d3ee, #3b82f6);
            color: white;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .shop-item-card {
            transition: all 0.2s;
        }

        .shop-item-card:active {
            transform: scale(0.95);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyDqlccYVYsY9lv-nwKSFGl6lYRqu_n-whI",
            authDomain: "hoony-6cddb.firebaseapp.com",
            projectId: "hoony-6cddb",
            storageBucket: "hoony-6cddb.firebasestorage.app",
            messagingSenderId: "782811839922",
            appId: "1:782811839922:web:f24064e6ca682a215678ab",
            measurementId: "G-R5C1GPWENT"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const analytics = firebase.analytics();

        // --- 1. ÏÉÅÏ†ê ÏïÑÏù¥ÌÖú Îç∞Ïù¥ÌÑ∞ ---
        const SHOP_ITEMS = {
            avatars: [
                { id: 'av_1', name: 'Í∏∞Î≥∏ ÏñºÍµ¥', price: 0, emoji: 'üòê', desc: 'ÏàúÏàòÌïú ÏòÅÌòº' },
                { id: 'av_2', name: 'Ïó¥Ï†ï Ïã†ÏûÖ', price: 5000000, emoji: 'üòÉ', desc: 'ÏïÑÏßÅ ÏÑ∏ÏÉÅ Î¨ºÏ†ï Î™®Î¶Ñ' },
                { id: 'av_3', name: 'ÏïºÍ∑º ÏöîÏ†ï', price: 15000000, emoji: 'üòµ‚Äçüí´', desc: 'Ïª§Ìîº ÏàòÌòà ÌïÑÏöî' },
                { id: 'av_4', name: 'ÏïàÍ≤Ω ÏÑ†Î∞∞', price: 30000000, emoji: 'üòé', desc: 'ÏûêÏã†Í∞ê ÎøúÎøú' },
                { id: 'av_5', name: 'ÌåêÍµê ÌûôÏä§ÌÑ∞', price: 50000000, emoji: 'üéß', desc: 'ÎÖ∏Ïù¥Ï¶à Ï∫îÏä¨ÎßÅ ON' },
                { id: 'av_6', name: 'ÏÑ±Í≥µÌïú Ïûê', price: 100000000, emoji: 'ü§ë', desc: 'ÎèàÏù¥ ÏµúÍ≥†Ïïº' },
                { id: 'av_7', name: 'AI Î°úÎ¥á', price: 300000000, emoji: 'ü§ñ', desc: 'Í∞êÏ†ï ÎÖ∏Îèô Ìï¥Î∞©' },
                { id: 'av_8', name: 'Ïô∏Í≥ÑÏù∏', price: 500000000, emoji: 'üëΩ', desc: 'ÏßÄÍµ¨ Ï†ïÎ≥µ ÏôÑÎ£å' }
            ],
            backgrounds: [
                { id: 'bg_1', name: 'ÏßÄÌïò Îã®Ïπ∏Î∞©', price: 0, style: 'bg-gray-800', desc: 'ÏäµÍ∏∞Í∞Ä Ï¢Ä Ï∞πÎãàÎã§' },
                { id: 'bg_2', name: 'Í≥µÏú† Ïò§ÌîºÏä§', price: 10000000, style: 'bg-slate-700', desc: 'Î™®ÎçòÌïú Í∑∏Î†àÏù¥ ÌÜ§' },
                { id: 'bg_3', name: 'ÌåêÍµê Î∑∞', price: 50000000, style: 'bg-gradient-to-b from-blue-900 to-slate-900', desc: 'ÏïºÍ≤ΩÏù¥ Î©ãÏßëÎãàÎã§' },
                { id: 'bg_4', name: 'Í∞ïÎÇ® ÌéúÌä∏ÌïòÏö∞Ïä§', price: 100000000, style: 'bg-gradient-to-br from-yellow-700 to-yellow-900', desc: 'ÏÑ±Í≥µÏùò Ìñ•Í∏∞' },
                { id: 'bg_5', name: 'Ïö∞Ï£º Ï†ïÍ±∞Ïû•', price: 500000000, style: 'bg-[url("https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1080&auto=format&fit=crop")] bg-cover bg-center', desc: 'Î¨¥Ï§ëÎ†• Í≥µÍ∞Ñ' }
            ],
            deskItems: [
                { id: 'dk_1', name: 'Îπà Ï±ÖÏÉÅ', price: 0, icon: '', desc: 'ÍπîÎÅîÌï©ÎãàÎã§' },
                { id: 'dk_2', name: 'ÏïÑÎ©îÎ¶¨Ïπ¥ÎÖ∏', price: 1000000, icon: '‚òï', desc: 'ÏÉùÏ°¥ ÌïÑÏàòÌíà' },
                { id: 'dk_3', name: 'Í≤åÏù¥Î∞ç ÎÖ∏Ìä∏Î∂Å', price: 3000000, icon: 'üíª', desc: 'RGB Í∞êÏÑ±' },
                { id: 'dk_4', name: 'Î∞òÎ†§ ÏãùÎ¨º', price: 5000000, icon: 'ü™¥', desc: 'ÎßàÏùåÏùò ÌèâÌôî' },
                { id: 'dk_5', name: 'Í∏à Ìä∏Î°úÌîº', price: 50000000, icon: 'üèÜ', desc: 'Ïò¨Ìï¥Ïùò ÏÇ¨Ïõê' },
                { id: 'dk_6', name: 'Í≥†ÏñëÏù¥', price: 100000000, icon: 'üêà', desc: 'Í∑ÄÏó¨ÏõÄ ÌïúÎèÑ Ï¥àÍ≥º' }
            ]
        };

        // --- 2. Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ ---
        const DEMO_DATA = [
            { "ÏßÅÏóÖÎ™Ö": "Ï∑®ÏóÖÏ§ÄÎπÑÏÉù", "ÏÑ§Î™Ö": "ÏïÑÏßÅ ÏßÅÏóÖÏùÑ Í∞ñÏßÄ Î™ªÌïú ÏÉÅÌÉúÏûÖÎãàÎã§.", "Ïó∞Î¥â": "0", "ÎÇúÏù¥ÎèÑ(ÎßåÏ°±ÎèÑ%)": "50" },
            { "ÏßÅÏóÖÎ™Ö": "Í∞ÄÏä§ Í≤ÄÏπ®Ïõê", "ÏÑ§Î™Ö": "Í∞ÄÏä§, ÏàòÎèÑ, Ï†ÑÎ†• ÏÇ¨Ïö©ÎüâÏùÑ Í≤ÄÏπ®ÌïòÍ≥† Í∏∞Î°ùÌïòÎäî ÏóÖÎ¨¥Î•º ÏàòÌñâÌï©ÎãàÎã§.", "Ïó∞Î¥â": "3Ï≤úÎßåÏõê‚Üì", "ÎÇúÏù¥ÎèÑ(ÎßåÏ°±ÎèÑ%)": "63.3" },
            { "ÏßÅÏóÖÎ™Ö": "Î¨ºÎ¶¨ÌïôÏó∞Íµ¨Ïõê", "ÏÑ§Î™Ö": "ÏûêÏó∞ÌòÑÏÉÅÏùò Í∏∞Î≥∏ Î≤ïÏπôÏùÑ Í∑úÎ™ÖÌïòÍ≥† ÏÇ∞ÏóÖ, ÏùòÎ£å Î∂ÑÏïº Îì±Ïóê ÏùëÏö©Ìï©ÎãàÎã§.", "Ïó∞Î¥â": "5Ï≤úÎßåÏõê‚Üë", "ÎÇúÏù¥ÎèÑ(ÎßåÏ°±ÎèÑ%)": "79.8" },
            { "ÏßÅÏóÖÎ™Ö": "Î™®Î∞îÏùºÏï±Í∞úÎ∞úÏûê", "ÏÑ§Î™Ö": "Ïä§ÎßàÌä∏Ìè∞ Î™®Î∞îÏùº Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ Í∞úÎ∞úÌïòÍ≥† ÏàòÏ†ïÌïòÎäî ÏùºÏùÑ Ìï©ÎãàÎã§.", "Ïó∞Î¥â": "4Ï≤úÎßåÏõê‚Üë", "ÎÇúÏù¥ÎèÑ(ÎßåÏ°±ÎèÑ%)": "69.2" }
        ];

        const processJobData = (rawData) => {
            return rawData.map((job, index) => {
                const salaryStr = job["Ïó∞Î¥â"] || "";
                let tier = 1;
                let baseSalary = 30000000;
                let cost = 300;

                if (salaryStr.includes("5Ï≤úÎßåÏõê")) { tier = 4; baseSalary = 60000000; cost = 6000; }
                else if (salaryStr.includes("4Ï≤úÎßåÏõê")) { tier = 3; baseSalary = 45000000; cost = 2500; }
                else if (salaryStr.includes("3Ï≤úÎßåÏõê‚Üë")) { tier = 2; baseSalary = 35000000; cost = 800; }

                const satStr = job["ÎÇúÏù¥ÎèÑ(ÎßåÏ°±ÎèÑ%)"] || "70";
                const satisfaction = parseFloat(satStr) || 70.0;
                const mentalDrain = Math.max(1, ((100 - satisfaction) / 10).toFixed(1));

                return {
                    id: index,
                    name: job["ÏßÅÏóÖÎ™Ö"] || "Ïïå Ïàò ÏóÜÎäî ÏßÅÏóÖ",
                    desc: job["ÏÑ§Î™Ö"] || "ÏÑ§Î™ÖÏù¥ ÏóÜÏäµÎãàÎã§.",
                    rawSalary: salaryStr || "3Ï≤úÎßåÏõê‚Üì",
                    baseSalary,
                    tier,
                    cost,
                    satisfaction,
                    mentalDrain
                };
            }).filter(j => j.name !== "ÏßÅÏóÖÎ™Ö");
        };

        const App = () => {
            // --- Game State ---
            const [localDb, setLocalDb] = useState(processJobData(DEMO_DATA)); // Renamed to localDb to avoid conflict
            const [isFullDataMode, setIsFullDataMode] = useState(false);
            const [currentJob, setCurrentJob] = useState(null);
            const [stats, setStats] = useState({ money: 0, exp: 0, mental: 100 });
            const [logs, setLogs] = useState(["Ïª§Î¶¨Ïñ¥ ÌïòÏù¥Ïóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§!"]);
            const [isBurnout, setIsBurnout] = useState(false);

            // --- Customization State ---
            const [inventory, setInventory] = useState(['av_1', 'bg_1', 'dk_1']);
            const [equipped, setEquipped] = useState({
                avatar: SHOP_ITEMS.avatars[0],
                background: SHOP_ITEMS.backgrounds[0],
                desk: SHOP_ITEMS.deskItems[0]
            });

            // --- Persistence State ---
            const [userId, setUserId] = useState(null);
            const [isLoaded, setIsLoaded] = useState(false);
            const [saveStatus, setSaveStatus] = useState(''); // 'saving', 'saved', 'error'

            // UI State
            const [view, setView] = useState("main");
            const [offers, setOffers] = useState([]);
            const [clickEffect, setClickEffect] = useState(null);
            const [activeTab, setActiveTab] = useState(0);

            // --- Helper Functions ---
            const addLog = (msg) => setLogs(prev => [msg, ...prev.slice(0, 3)]);
            const formatNum = (n) => n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            // --- Persistence Logic ---
            useEffect(() => {
                // Initialize ID
                let storedId = localStorage.getItem('career_high_uid');
                if (!storedId) {
                    storedId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('career_high_uid', storedId);
                }
                setUserId(storedId);

                // Load Data
                const loadData = async () => {
                    if (!storedId) return;
                    try {
                        const docRef = db.collection('users').doc(storedId);
                        const doc = await docRef.get();
                        if (doc.exists) {
                            const data = doc.data();
                            // Restore state
                            if (data.stats) setStats(data.stats);
                            if (data.inventory) setInventory(data.inventory);

                            // Restore equipped items (deep check)
                            if (data.equippedIds) {
                                setEquipped({
                                    avatar: SHOP_ITEMS.avatars.find(i => i.id === data.equippedIds.avatar) || SHOP_ITEMS.avatars[0],
                                    background: SHOP_ITEMS.backgrounds.find(i => i.id === data.equippedIds.background) || SHOP_ITEMS.backgrounds[0],
                                    desk: SHOP_ITEMS.deskItems.find(i => i.id === data.equippedIds.desk) || SHOP_ITEMS.deskItems[0],
                                });
                            }

                            if (data.currentJob) setCurrentJob(data.currentJob);
                            addLog("‚òÅÔ∏è [Î°úÎìú] Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ ÏÑ±Í≥µ!");
                        } else {
                            addLog("‚ú® [Ï≤´ ÏãúÏûë] ÏÉàÎ°úÏö¥ Ïª§Î¶¨Ïñ¥Î•º ÏãúÏûëÌï©ÎãàÎã§.");
                        }
                    } catch (err) {
                        console.error("Load Error:", err);
                        addLog("‚ùå [Î°úÎìú Ïã§Ìå®] " + err.message);
                    } finally {
                        setIsLoaded(true);
                    }
                };

                loadData();
            }, []);

            // Auto-Save Effect
            useEffect(() => {
                if (!isLoaded || !userId) return;

                const saveData = async () => {
                    setSaveStatus('saving');
                    try {
                        const saveData = {
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                            stats,
                            inventory,
                            equippedIds: {
                                avatar: equipped.avatar.id,
                                background: equipped.background.id,
                                desk: equipped.desk.id
                            },
                            currentJob
                        };

                        await db.collection('users').doc(userId).set(saveData, { merge: true });
                        setSaveStatus('saved');
                        // setTimeout(() => setSaveStatus(''), 2000); 
                    } catch (err) {
                        console.error("Save Error:", err);
                        setSaveStatus('error');
                    }
                };

                // Debounce save (save 1 second after last change)
                const timeoutId = setTimeout(saveData, 2000);
                return () => clearTimeout(timeoutId);

            }, [stats, inventory, equipped, currentJob, isLoaded, userId]);


            // --- Game Loop ---
            useEffect(() => {
                const timer = setInterval(() => {
                    if (isBurnout) return;
                    if (currentJob) {
                        setStats(prev => ({
                            ...prev,
                            money: prev.money + Math.floor(currentJob.baseSalary / 12 / 10)
                        }));
                    }
                    setStats(prev => ({
                        ...prev,
                        mental: Math.min(100, prev.mental + (currentJob ? 0.2 : 1.0))
                    }));
                }, 100);
                return () => clearInterval(timer);
            }, [currentJob, isBurnout]);

            useEffect(() => {
                if (stats.mental <= 0 && !isBurnout) {
                    setIsBurnout(true);
                    addLog("üî• [Î≤àÏïÑÏõÉ] Ìú¥ÏãùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§!");
                    setTimeout(() => {
                        setIsBurnout(false);
                        setStats(prev => ({ ...prev, mental: 50 }));
                        addLog("‚òï [ÌöåÎ≥µ] ÏóÖÎ¨¥ Î≥µÍ∑Ä!");
                    }, 5000);
                }
            }, [stats.mental]);

            // --- Shop Logic ---
            const buyItem = (item, type) => {
                console.log("Attempting to buy:", item, "Current Money:", stats.money);
                if (stats.money >= item.price) {
                    setStats(prev => ({ ...prev, money: prev.money - item.price }));
                    setInventory(prev => [...prev, item.id]);
                    setEquipped(prev => ({ ...prev, [type]: item }));
                    addLog(`üõçÔ∏è [Íµ¨Îß§ ÏÑ±Í≥µ] ${item.name} (-${formatNum(item.price)})`);
                    // alert(`Íµ¨Îß§ ÏÑ±Í≥µ! ${item.name}`); // Optional: Uncomment if logs are not enough
                } else {
                    console.warn("Purchase failed: Insufficient funds");
                    addLog(`üí∏ ÏûîÏï°Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§! (ÌïÑÏöî: ‚Ç©${formatNum(item.price)})`);
                    alert("ÏûîÏï°Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§!");
                }
            };

            const equipItem = (item, type) => {
                setEquipped(prev => ({ ...prev, [type]: item }));
                addLog(`‚ú® [Ïû•Ï∞©] ${item.name} Ï†ÅÏö© ÏôÑÎ£å`);
            };

            // --- Handlers ---
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                Papa.parse(file, {
                    header: true, skipEmptyLines: true,
                    complete: (results) => {
                        if (results.data?.length > 0) {
                            const newDb = processJobData(results.data);
                            setLocalDb(newDb);
                            setIsFullDataMode(true);
                            addLog(`üìÇ ${newDb.length}Í∞ú ÏßÅÏóÖ Îç∞Ïù¥ÌÑ∞ Î°úÎìú!`);
                            generateOffers(newDb);
                        }
                    },
                    error: (err) => alert("Error: " + err.message)
                });
            };

            const generateOffers = (database = localDb) => {
                if (database.length < 3) return;
                const pool = database.filter(j => Math.abs(j.tier - (currentJob?.tier || 1)) <= 1);
                const finalPool = pool.length > 3 ? pool : database;
                setOffers([...finalPool].sort(() => 0.5 - Math.random()).slice(0, 3));
            };

            const handleClick = (e) => {
                if (isBurnout) return;
                const rect = e.target.getBoundingClientRect();
                setClickEffect({ x: e.clientX - rect.left, y: e.clientY - rect.top, id: Date.now() });

                let expGain = 20 + (currentJob ? currentJob.tier * 10 : 0);
                let mentalCost = currentJob ? currentJob.mentalDrain : 1;

                setStats(prev => ({
                    ...prev,
                    exp: prev.exp + expGain,
                    mental: Math.max(0, prev.mental - mentalCost),
                    money: Number(prev.money) + (currentJob ? currentJob.tier * 1000 : 100) // Ensure money is treated as number
                }));
            };

            const applyJob = (job) => {
                if (stats.exp < job.cost) {
                    addLog(`‚ö†Ô∏è Ïó≠Îüâ Î∂ÄÏ°± (ÌïÑÏöî: ${formatNum(job.cost)})`);
                    return;
                }
                setStats(prev => ({ ...prev, exp: Math.floor(prev.exp * 0.8) }));
                setCurrentJob(job);
                setView("main");
                addLog(`üéâ [Ïù¥ÏßÅ] ${job.name} Ìï©Í≤©!`);
            };

            // --- Renderers ---
            const renderMain = () => (
                <div className="flex flex-col h-full p-6 pt-8">
                    {/* Top Info */}
                    <div className="mb-4 flex justify-between items-center z-10 relative">
                        <div>
                            <span className={`px-2 py-0.5 rounded text-xs font-bold tier-badge-${currentJob?.tier || 1} mr-2 shadow-sm`}>
                                {currentJob ? `TIER ${currentJob.tier}` : 'Î¨¥ÏßÅ'}
                            </span>
                            <span className="text-sm font-bold truncate">{currentJob ? currentJob.name : 'Ï∑®ÏóÖÏ§ÄÎπÑÏÉù'}</span>
                        </div>
                        <div className="text-right">
                            <div className="text-xs text-blue-200">
                                ÌòÑÏû¨ ÏûêÏÇ∞
                                {saveStatus === 'saving' && <span className="ml-2 text-yellow-400 animate-pulse"><i className="fa-solid fa-floppy-disk"></i> Ï†ÄÏû•Ï§ë...</span>}
                                {saveStatus === 'saved' && <span className="ml-2 text-green-400 transition-opacity duration-1000"><i className="fa-solid fa-check"></i> Ï†ÄÏû•Îê®</span>}
                                {saveStatus === 'error' && <span className="ml-2 text-red-400"><i className="fa-solid fa-triangle-exclamation"></i> Ï†ÄÏû•Ïã§Ìå®</span>}
                            </div>
                            <div className="text-xl font-bold text-green-400 font-num drop-shadow-md">‚Ç© {formatNum(stats.money)}</div>
                        </div>
                    </div>

                    {/* Visual Stage */}
                    <div className={`relative w-full h-64 rounded-2xl mb-6 shadow-2xl overflow-hidden border border-white/10 transition-all duration-500 ${equipped.background.style}`}>
                        {/* Desk Item (Behind or Next to Avatar) */}
                        <div className="absolute bottom-16 right-16 text-[60px] filter drop-shadow-lg z-10 transform translate-x-4 translate-y-4">
                            {equipped.desk.icon}
                        </div>

                        {/* Avatar */}
                        <div className="absolute inset-0 flex items-center justify-center z-20">
                            <div className="text-[100px] filter drop-shadow-2xl transform hover:scale-110 transition cursor-pointer relative" onClick={handleClick}>
                                {isBurnout ? 'ü•µ' : equipped.avatar.emoji}
                                {/* Optional: Add a subtle glow or effect based on tier if needed */}
                            </div>
                        </div>

                        {/* Logs Overlay */}
                        <div className="absolute bottom-0 left-0 w-full p-3 bg-gradient-to-t from-black/80 to-transparent z-30 pointer-events-none">
                            <div className="flex flex-col space-y-1">
                                {logs.map((log, i) => (
                                    <div key={i} className="text-xs text-white/90 font-light truncate animate-pop">
                                        ‚Ä¢ {log}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* Stats */}
                    <div className="space-y-3 mb-4">
                        <div>
                            <div className="flex justify-between text-xs mb-1">
                                <span className={stats.mental < 30 ? "text-red-400 font-bold" : "text-gray-300"}>MENTAL</span>
                                <span>{Math.floor(stats.mental)}%</span>
                            </div>
                            <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
                                <div className={`h-full transition-all duration-300 ${stats.mental < 30 ? 'bg-red-500' : 'bg-blue-500'}`} style={{ width: `${stats.mental}%` }}></div>
                            </div>
                        </div>
                        <div>
                            <div className="flex justify-between text-xs mb-1">
                                <span className="text-gray-300">EXP (Next: {currentJob ? formatNum(currentJob.cost * 2) : "Ï∑®ÏóÖ"})</span>
                                <span className="text-yellow-400">{formatNum(stats.exp)}</span>
                            </div>
                            <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
                                <div className="h-full bg-yellow-500 transition-all duration-200" style={{ width: `${Math.min(100, stats.exp / ((currentJob?.cost || 300) * 2)) * 100}%` }}></div>
                            </div>
                        </div>
                    </div>

                    {/* Main Button */}
                    <button
                        onClick={handleClick}
                        disabled={isBurnout}
                        className={`w-full flex-1 rounded-2xl font-black text-2xl shadow-lg transition-all relative overflow-hidden group
                            ${isBurnout ? 'bg-gray-600 cursor-not-allowed' : 'bg-gradient-to-br from-blue-600 to-indigo-700 active:scale-95'}`}
                    >
                        <span className="relative z-10">{isBurnout ? 'Ìú¥Ïãù Ï§ë...' : 'ÏóÖÎ¨¥ ÏàòÌñâ (WORK)'}</span>
                        {clickEffect && (
                            <span
                                key={clickEffect.id}
                                className="absolute bg-white/30 rounded-full w-20 h-20 animate-ping"
                                style={{ left: clickEffect.x - 40, top: clickEffect.y - 40, pointerEvents: 'none' }}
                            />
                        )}
                    </button>
                </div>
            );

            const renderShop = () => {
                const categories = [
                    { id: 'avatars', name: 'ÏïÑÎ∞îÌÉÄ', data: SHOP_ITEMS.avatars, equipType: 'avatar' },
                    { id: 'backgrounds', name: 'Ïò§ÌîºÏä§', data: SHOP_ITEMS.backgrounds, equipType: 'background' },
                    { id: 'deskItems', name: 'Îç∞Ïä§ÌÅ¨', data: SHOP_ITEMS.deskItems, equipType: 'desk' }
                ];

                return (
                    <div className="flex flex-col h-full p-6 pt-10">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-2xl font-bold">üíé FLEX ÏÉÅÏ†ê</h2>
                            <div className="text-right">
                                <span className="text-xs text-gray-400 block">ÎÇ¥ ÏûêÏÇ∞</span>
                                <span className="text-lg font-bold text-green-400 font-num">‚Ç© {formatNum(stats.money)}</span>
                            </div>
                        </div>

                        {/* Shop Tabs */}
                        <div className="flex bg-gray-800 rounded-lg p-1 mb-4">
                            {categories.map((cat, idx) => (
                                <button
                                    key={cat.id}
                                    onClick={() => setActiveTab(idx)}
                                    className={`flex-1 py-2 text-xs font-bold rounded-md transition ${activeTab === idx ? 'bg-blue-600 text-white shadow-md' : 'text-gray-400 hover:text-gray-200'}`}
                                >
                                    {cat.name}
                                </button>
                            ))}
                        </div>

                        {/* Item Grid */}
                        <div className="flex-1 overflow-y-auto grid grid-cols-2 gap-3 scrollbar-hide pb-20">
                            {categories[activeTab].data.map((item) => {
                                const isOwned = inventory.includes(item.id);
                                const isEquipped = equipped[categories[activeTab].equipType].id === item.id;

                                return (
                                    <div key={item.id} className="bg-gray-800 p-3 rounded-xl border border-gray-700 flex flex-col justify-between shop-item-card relative overflow-hidden group">
                                        {isEquipped && <div className="absolute top-0 right-0 bg-yellow-500 text-black text-[10px] font-bold px-2 py-0.5 rounded-bl-lg z-10 shadow-md">Ïû•Ï∞©Ï§ë</div>}

                                        <div className="text-center py-3">
                                            <div className="text-4xl mb-2 transform group-hover:scale-110 transition">{item.emoji || item.icon || (item.style ? 'üé®' : '')}</div>
                                            <h3 className="font-bold text-sm text-white">{item.name}</h3>
                                            <p className="text-[10px] text-gray-400 mt-0.5">{item.desc}</p>

                                            {/* Í∞ÄÍ≤© ÌëúÏãú Ï∂îÍ∞Ä */}
                                            <div className={`mt-2 font-num font-bold ${isOwned ? 'text-gray-500 line-through' : 'text-green-400'}`}>
                                                {item.price === 0 ? 'Î¨¥Î£å' : `‚Ç© ${formatNum(item.price)}`}
                                            </div>
                                        </div>

                                        <div className="mt-1">
                                            {!isOwned ? (
                                                <button
                                                    onClick={() => buyItem(item, categories[activeTab].equipType)}
                                                    className={`w-full py-2 rounded-lg text-xs font-bold shadow-sm transition active:scale-95 flex items-center justify-center gap-1
                                                        ${stats.money >= item.price
                                                            ? 'bg-green-600 hover:bg-green-500 text-white shadow-green-900/50'
                                                            : 'bg-gray-700 text-gray-500 cursor-not-allowed'}`}
                                                >
                                                    {stats.money >= item.price ? <i className="fa-solid fa-cart-shopping"></i> : <i className="fa-solid fa-lock"></i>}
                                                    {stats.money >= item.price ? 'Íµ¨Îß§ÌïòÍ∏∞' : 'ÏûîÏï°Î∂ÄÏ°±'}
                                                </button>
                                            ) : (
                                                <button
                                                    onClick={() => equipItem(item, categories[activeTab].equipType)}
                                                    disabled={isEquipped}
                                                    className={`w-full py-2 rounded-lg text-xs font-bold transition
                                                        ${isEquipped
                                                            ? 'bg-gray-700 text-gray-400 cursor-default'
                                                            : 'bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-900/50'}`}
                                                >
                                                    {isEquipped ? 'ÏÇ¨Ïö©Ï§ë' : 'Ïû•Ï∞©ÌïòÍ∏∞'}
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                );
            };

            const renderOffers = () => (
                <div className="flex flex-col h-full p-6 pt-10">
                    <h2 className="text-2xl font-bold mb-4">Ï±ÑÏö© Í≥µÍ≥†</h2>
                    {!isFullDataMode && (
                        <div className="mb-4 p-3 bg-indigo-900/50 border border-indigo-500 rounded-xl text-center">
                            <label className="block w-full bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold py-3 rounded cursor-pointer transition">
                                <i className="fa-solid fa-upload mr-2"></i>Ï†ÑÏ≤¥ ÏßÅÏóÖ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ (CSV)
                                <input type="file" accept=".csv" onChange={handleFileUpload} className="hidden" />
                            </label>
                        </div>
                    )}
                    <div className="flex-1 overflow-y-auto space-y-3 scrollbar-hide pb-20">
                        {offers.map((job) => (
                            <div key={job.id} className="bg-gray-800 p-4 rounded-xl border border-gray-700 hover:border-blue-500 transition">
                                <div className="flex justify-between items-start mb-1">
                                    <h3 className="font-bold text-lg">{job.name}</h3>
                                    <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded tier-badge-${job.tier}`}>TIER {job.tier}</span>
                                </div>
                                <div className="grid grid-cols-2 gap-2 text-xs mb-3 bg-gray-900/50 p-2 rounded">
                                    <div>
                                        <span className="block text-gray-500">Ïó∞Î¥â</span>
                                        <span className="text-green-400 font-bold">{job.rawSalary}</span>
                                    </div>
                                    <div>
                                        <span className="block text-gray-500">ÌïÑÏöî Ïó≠Îüâ</span>
                                        <span className={`${stats.exp >= job.cost ? 'text-blue-400' : 'text-red-400'} font-bold`}>{formatNum(job.cost)}</span>
                                    </div>
                                </div>
                                <button
                                    onClick={() => applyJob(job)}
                                    className={`w-full py-3 rounded-lg font-bold text-sm transition 
                                        ${stats.exp >= job.cost ? 'bg-blue-600 hover:bg-blue-500 text-white' : 'bg-gray-700 text-gray-500'}`}
                                >
                                    {stats.exp >= job.cost ? 'ÏßÄÏõêÌïòÍ∏∞' : 'Ïó≠Îüâ Î∂ÄÏ°±'}
                                </button>
                            </div>
                        ))}
                    </div>
                    <button onClick={() => generateOffers()} className="absolute bottom-24 left-6 right-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-xl font-bold text-sm">
                        üîÑ Í≥µÍ≥† ÏÉàÎ°úÍ≥†Ïπ®
                    </button>
                </div>
            );

            const renderRanking = () => (
                <div className="flex flex-col h-full p-6 pt-10">
                    <h2 className="text-2xl font-bold mb-4">üèÜ Îû≠ÌÇπ (Ï§ÄÎπÑÏ§ë)</h2>
                    <div className="flex-1 flex items-center justify-center text-gray-500">
                        <p>ÏàúÏúÑ ÏãúÏä§ÌÖú ÏÑúÎ≤Ñ Ï†êÍ≤Ä Ï§ëÏûÖÎãàÎã§.</p>
                    </div>
                </div>
            );

            // --- Main Layout ---
            return (
                <div className="max-w-md mx-auto h-screen bg-gray-900 shadow-2xl overflow-hidden relative">
                    <div className="h-full pb-20">
                        {view === 'main' && renderMain()}
                        {view === 'shop' && renderShop()}
                        {view === 'offers' && renderOffers()}
                        {view === 'ranking' && renderRanking()}
                    </div>

                    {/* Bottom Nav */}
                    <div className="absolute bottom-0 left-0 w-full bg-gray-800 border-t border-gray-700 flex justify-around p-3 pb-6 z-50">
                        <button onClick={() => setView('main')} className={`flex flex-col items-center ${view === 'main' ? 'text-blue-400' : 'text-gray-500'}`}>
                            <i className="fa-solid fa-briefcase text-xl mb-1"></i>
                            <span className="text-[10px]">Ìôà</span>
                        </button>
                        <button onClick={() => setView('shop')} className={`flex flex-col items-center ${view === 'shop' ? 'text-blue-400' : 'text-gray-500'}`}>
                            <i className="fa-solid fa-cart-shopping text-xl mb-1"></i>
                            <span className="text-[10px]">ÏÉÅÏ†ê</span>
                        </button>
                        <button onClick={() => { setView('offers'); generateOffers(); }} className={`flex flex-col items-center ${view === 'offers' ? 'text-blue-400' : 'text-gray-500'}`}>
                            <i className="fa-solid fa-file-signature text-xl mb-1"></i>
                            <span className="text-[10px]">Í≥µÍ≥†</span>
                        </button>
                        <button onClick={() => setView('ranking')} className={`flex flex-col items-center ${view === 'ranking' ? 'text-blue-400' : 'text-gray-500'}`}>
                            <i className="fa-solid fa-trophy text-xl mb-1"></i>
                            <span className="text-[10px]">Îû≠ÌÇπ</span>
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>

</html>
